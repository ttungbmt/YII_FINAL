{"version":3,"sources":["core-map.js"],"names":[],"mappings":"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","file":"core-map-compiled.js","sourcesContent":["var map,\r\n    BASE_URL,\r\n    dichteGroup,\r\n    GEOSERVER_ADDRESS,\r\n    dataOdich;\r\n\r\nvar dichteGroup = new L.featureGroup();\r\nvar drawnItemsOnMap = new L.FeatureGroup(); drawnItemsOnMap.setZIndex(1000);\r\nvar m = {};\r\n\r\n\r\n\r\n// Cấu hình dùng cho khởi tạo WMS layer.\r\nif(typeof BASE_URL === 'undefined' || BASE_URL=='/'){\r\n    GEOSERVER_ADDRESS = \"http://pcd.hcmgis.vn/geoserver2/wms\";\r\n} else {\r\n    GEOSERVER_ADDRESS = BASE_URL + \"../../geoserver2/wms\";\r\n}\r\n\r\nclass Map {\r\n    mapOptions = {\r\n        center: [10.8556284832574, 106.744985842335],\r\n        zoom: 13,\r\n        fullscreenControl: true,\r\n    };\r\n\r\n    init(){\r\n        map = new L.Map('div_map', this.mapOptions);\r\n        this.addLayers();\r\n\r\n        // Init map layer\r\n        this.initMapLayer();\r\n        // Init map control\r\n        this.initMapControl();\r\n\r\n        this.mapReady();\r\n\r\n        this.actEvents();\r\n    }\r\n\r\n    addLayers() {\r\n        dichteGroup.addTo(map);\r\n        map.addLayer(drawnItemsOnMap);\r\n    }\r\n\r\n    initMapLayer() {\r\n        let tileWMS = new m.TileWMS(GEOSERVER_ADDRESS);\r\n\r\n        let mapBox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {id: 'mapbox.streets', accessToken: 'pk.eyJ1IjoidHR1bmdibXQiLCJhIjoiY2EzNDFhZjU4ZThkNzY5NTU3M2U1YWFiNmY4OTE3OWQifQ.Bo1ss5J4UjPPOjmq9S3VQw'});\r\n        let ranhphuong =  tileWMS.getLayer('dichte:dm_phuong');\r\n        let cabenh = tileWMS.getLayer('dichte:v_cabenh');\r\n        let vungbenh = tileWMS.getLayer('dichte:v_vungbenh');\r\n\r\n        L.control.layers({\r\n            'Mapbox': mapBox,\r\n            'OSM': L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png'),\r\n            'Google': L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {subdomains: ['mt0', 'mt1', 'mt2', 'mt3']}),\r\n            'Vệ tinh': L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {subdomains: ['mt0', 'mt1', 'mt2', 'mt3']}),\r\n            'Hàng không': L.tileLayer('http://hcmgisportal.vn/basemap/cache_lidar/{z}/{x}/{y}.jpg'),\r\n        }, {\r\n            'Ca bệnh': cabenh,\r\n            'Bản đồ vùng dịch': vungbenh,\r\n            'Ranh quận': tileWMS.getLayer('dichte:dm_quan'),\r\n            'Ranh phường': ranhphuong,\r\n            'Ranh tổ': tileWMS.getLayer('dichte:ranh_to'),\r\n            'Điểm thửa': tileWMS.getLayer('dichte:rt_point'),\r\n        }).addTo(map);\r\n\r\n        map.addLayer(mapBox, true);\r\n        layerRanhphuong = ranhphuong;\r\n        layerCabenh = cabenh;\r\n        layerVungbenh = vungbenh;\r\n        checkRanhphuong();\r\n    }\r\n\r\n    initMapControl() {\r\n        L.control.measure({position: 'topright'}).addTo(map);\r\n        map.addControl(new m.DrawControl(drawnItemsOnMap));\r\n\r\n    }\r\n\r\n    mapReady(){\r\n\r\n        var style = {\r\n            'default': {\r\n                'color': 'yellow'\r\n            },\r\n            'highlight': {\r\n                'color': 'green'\r\n            }\r\n        };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        $('#mOdich').on('show.bs.modal', function () {\r\n            let layers = drawnItemsOnMap.getLayers().map((v, k)=> {\r\n                return _.has(v, '_mRadius') ? _.first(turf.buffer(v.toGeoJSON(), v.getRadius(), 'meters').features) : v.toGeoJSON();\r\n            });\r\n\r\n\r\n            var merge = turf.merge(turf.featurecollection(layers));\r\n            var area = turf.area(merge);\r\n            var geomData = {area: area, geojson: merge.geometry};\r\n\r\n            $.ajax({\r\n                type: 'POST',\r\n                url: BASE_URL + 'geo/dichte-in-polygon',\r\n                data: {type: 'odich', 'sql': MAP_USER_FILTER, geomData: geomData},\r\n                success: function (html) {\r\n                    $('#mOdich .modal-body').html(html);\r\n                }\r\n            });\r\n        })\r\n    }\r\n\r\n    actEvents() {\r\n        map.on('draw:created', e => this.editDraw(e));\r\n        map.on('draw:edited', e => this.editDraw(e));\r\n    }\r\n\r\n    editDraw(e) {\r\n        const {layer, layerType, type} = e;\r\n        layer.type = layerType;\r\n\r\n        switch (type){\r\n            case 'draw:created': { drawnItemsOnMap.addLayer(layer); break;}\r\n        }\r\n\r\n\r\n        layer.on('click', e => {\r\n            let highlight = m.DrawControl.highlight;\r\n            let def = m.DrawControl.style.circle;\r\n\r\n            if (e.originalEvent.ctrlKey) {\r\n                if(layer.style == highlight){\r\n                    layer.style = def;\r\n                    layer.setStyle(def);\r\n                    return;\r\n                }\r\n\r\n                layer.style = highlight;\r\n                layer.setStyle(highlight);\r\n            }\r\n\r\n            var circleHl = _.filter(drawnItemsOnMap.getLayers(), {style: m.DrawControl.highlight})\r\n                .map((cir) => { return cvGeom(cir).geoJSON; })\r\n\r\n            if(!_.isEmpty(circleHl)){\r\n                let mergeCir = turf.merge(turf.featurecollection(circleHl));\r\n                dataOdich = {\r\n                    area: turf.area(mergeCir),\r\n                    geoJSON: mergeCir.geometry\r\n                };\r\n                // callDatas({}, geomData);\r\n                postOdich(dataOdich).done(html => callPopup(html));\r\n            }\r\n\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\nvar cvGeom = (geom) => {\r\n    let radius;\r\n    let type = geom.type;\r\n    let geoJSON = geom.toGeoJSON();\r\n\r\n    if(type == 'circle'){\r\n        radius = geom.getRadius();\r\n        geoJSON = circle2polygon(geom.getCentroid(), radius).toGeoJSON();\r\n    }\r\n\r\n    return {\r\n        type, radius, geoJSON, geom\r\n    }\r\n}\r\n\r\nvar circle2polygon = (center, radius = 200, parts = 200) => {\r\n    return LGeo.circle(center, radius, {parts});\r\n}\r\n\r\nvar postOdich = function (geomData = dataOdich,\r\n                          url = BASE_URL + 'geo/dichte-in-polygon') {\r\n    return $.ajax({\r\n        type: 'POST',\r\n        url,\r\n        data: {'sql': MAP_USER_FILTER, geomData: geomData},\r\n    })\r\n}\r\n\r\n\r\nclass TileWMS {\r\n    defaultParams = {\r\n        service: 'WMS',\r\n        layers: '',\r\n        format: 'image/png',\r\n        transparent: true\r\n    };\r\n\r\n    get WMSOptions() {\r\n        return this.defaultParams;\r\n    }\r\n\r\n    set WMSOptions(append) {\r\n        this.defaultParams = Object.assign({}, this.WMSOptions, append);\r\n    }\r\n\r\n    constructor(url){\r\n        this.url = url;\r\n    }\r\n    \r\n    getLayer(layerName){\r\n        this.WMSOptions = {layers: layerName};\r\n        return new L.TileLayer.BetterWMS(this.url, this.WMSOptions);\r\n    }\r\n}\r\n\r\nclass DrawControl {\r\n\r\n    static style = {\r\n        circle: {\r\n            color: '#f06eaa',\r\n        },\r\n        polyline: {\r\n\r\n        },\r\n        polygon: {\r\n\r\n        },\r\n        marker: {\r\n\r\n        },\r\n        rectangle: {\r\n\r\n        }\r\n    }\r\n\r\n    static highlight = {\r\n        color: 'yellow'\r\n    }\r\n\r\n\r\n    static drawLocale = {\r\n        draw: {\r\n            toolbar: {\r\n                actions: {\r\n                    title: 'Hủy bỏ', // Cancel drawing\r\n                    text: 'Hủy bỏ' // Cancel\r\n                },\r\n                undo: {\r\n                    title: 'Xóa điểm đã vẽ cuối cùng', //Delete last point drawn\r\n                    text: 'Xóa điểm cuối cùng', //Delete last point'\r\n                },\r\n                buttons: {\r\n                    polyline: 'Vẽ đường', // Draw a polyline\r\n                    polygon: 'Vẽ đa giác', // Draw a polygon\r\n                    rectangle: 'Vẽ hình chữ nhật', // Draw a rectangle\r\n                    circle: 'Vẽ đường tròn', // Draw a circle\r\n                    marker: 'Thêm điểm', // Draw a marker\r\n                },\r\n                finish: {\r\n                    title: 'Kết thúc',\r\n                    text: 'Kết thúc',\r\n                }\r\n            },\r\n            handlers: {\r\n                circle: {\r\n                    tooltip: {\r\n                        start: 'Click và kéo chuột để vẽ đường tròn.' //Click and drag to draw circle.\r\n                    },\r\n                    radius: 'Bán kính' // Radius\r\n                },\r\n                marker: {\r\n                    tooltip: {\r\n                        start: 'Click lên bản đồ để đặt marker' //Click map to place marker.\r\n                    }\r\n                },\r\n                polygon: {\r\n                    tooltip: {\r\n                        start: 'Click để bắt đầu vẽ hình', // Click to start drawing shape.\r\n                        cont: 'Click để tiếp tục vẽ hình', //Click to continue drawing shape.\r\n                        end: 'Click điểm đầu để khép hình', // 'Click first point to close this shape.'\r\n                    }\r\n                },\r\n                polyline: {\r\n                    error: '<strong>Lỗi:</strong> Các cạnh không được bắt chéo!' , // '<strong>Error:</strong> shape edges cannot cross!',\r\n                    tooltip: {\r\n                        start: 'Click để bắt đầu vẽ đường', // Click to start drawing line.\r\n                        cont: 'Click để tiếp tục vẽ đường', // Click to continue drawing line.\r\n                        end: 'Click điểm cuỗi để kết thúc đường'// Click last point to finish line.\r\n                    }\r\n                },\r\n                rectangle: {\r\n                    tooltip: {\r\n                        start: 'Click và kéo chuột để vẽ hình chữ nhật', // Click and drag to draw rectangle\r\n                    }\r\n                },\r\n                simpleshape: {\r\n                    tooltip: {\r\n                        end: 'Thả chuột để kết thúc'// Release mouse to finish drawing.\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        edit: {\r\n            toolbar: {\r\n                actions: {\r\n                    save: {\r\n                        title: 'Lưu những thay đổi', // Save changes.\r\n                        text: 'Lưu' // Save\r\n                    },\r\n                    cancel: {\r\n                        title: 'Hủy bỏ chỉnh sửa, bỏ tất cả những thay đổi',// Cancel editing, discards all changes.\r\n                        text: 'Hủy bỏ' // Cancel\r\n                    }\r\n                },\r\n                buttons: {\r\n                    buffer: 'Mở rộng lớp', // Expand layers.\r\n                    bufferDisabled: 'Không có lớp để mở rộng', // No layers to expand.\r\n                    edit: 'Xóa lớp', // Edit layers.\r\n                    editDisabled: 'Không có lớp để chỉnh sửa', //No layers to edit.\r\n                    remove: 'Xóa lớp', //Delete layers.\r\n                    removeDisabled: 'Không có lớp để xóa', // No layers to delete.\r\n                }\r\n            },\r\n            handlers: {\r\n                buffer: {\r\n                    tooltip: {\r\n                        text: 'Click và kéo chuột để mở rộng hoặc thu hẹp hình'// Click and drag to expand or contract a shape.\r\n                    }\r\n                },\r\n                edit: {\r\n                    tooltip: {\r\n                        text: 'Kéo chuột hoặc đánh dấu để chỉnh sửa đối tượng', // Drag handles, or marker to edit feature.\r\n                        subtext: 'Click hủy bỏ để quay lại', // Click cancel to undo changes.\r\n                    }\r\n                },\r\n                remove: {\r\n                    tooltip: {\r\n                        text: 'Click lên đối tượng để xóa' // Click on a feature to remove\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    constructor(featureDraw){\r\n        return this.initDraw(featureDraw);\r\n    }\r\n\r\n    initDraw(featureDraw){\r\n        // L.drawLocal = this.drawLocale;\r\n\r\n        return drawControl = new L.Control.Draw({\r\n            position: 'topright',\r\n\r\n            edit: {\r\n                featureGroup: featureDraw,\r\n                remove: true,\r\n                buffer: {\r\n                    replace_polylines: false,\r\n                    separate_buffer: false\r\n                }\r\n            },\r\n            draw: {\r\n                polyline: {metric: true}, marker: false, rectangle: false, circle: {metric: true},\r\n                polygon: {\r\n                    showArea: true\r\n                }\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\nfunction editDraw(e, create) {\r\n    var type = e.layerType,\r\n        layer = e.layer;\r\n\r\n\r\n\r\n    // Do whatever else you need to. (save to db, add to 2map etc)\r\n//        drawnItemsOnMap.clearLayer();\r\n    //if (preLayer !== null)\r\n    //drawnItemsOnMap.removeLayer(preLayer);\r\n    if (create)\r\n        drawnItemsOnMap.addLayer(layer);\r\n    //preLayer = layer;\r\n    var layers = drawnItemsOnMap.getLayers();\r\n    var postData = [];\r\n    for(var i = 0; i< layers.length; i++) {\r\n        layer = layers[i];\r\n\r\n        if (typeof(layer._mRadius) === 'undefined') {\r\n            var latlngs = layer.getLatLngs();\r\n            postData[i] = {'bound': getStringFromLatLngs(latlngs)};\r\n        } else {\r\n            var latlng = layer.getLatLng();\r\n            var radius = layer.getRadius();\r\n\r\n            postData[i] =  {'data' : {'geom_x': latlng.lng, 'geom_y':latlng.lat , 'radius' : radius}};\r\n        }\r\n    }\r\n\r\n    var bin = [];\r\n    for(var i = 0; i< layers.length; i++) {\r\n        bin[i] = _.has(layers[i], '_mRadius') ? _.first(turf.buffer(layers[i].toGeoJSON(), layers[i].getRadius(), 'meters').features) : layers[i].toGeoJSON();\r\n    }\r\n\r\n    var merge = turf.merge(turf.featurecollection(bin));\r\n    var area = turf.area(merge);\r\n    var geomData = {area: area, geojson: merge.geometry};\r\n    callDatas(postData, geomData);\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nm.DrawControl = DrawControl;\r\nm.TileWMS = TileWMS;\r\n\r\nvar appMap = new Map();\r\n$(document).ready(() => {\r\n    if( $('#div_map').length ) {appMap.init()};\r\n\r\n\r\n\r\n\r\n    // setTimeout(() => {\r\n    //\r\n    // }, 3000)\r\n\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar FORMAT = \"image/png8\";\r\nvar TRANSPARENT = true;\r\nvar TILED = true;\r\nvar interval_created = false;\r\nvar features_time_counter = 0;\r\nvar VERSION = \"1.1.0\";\r\n\r\n// proj4.defs(\"urn:ogc:def:crs:EPSG::32648\", \"+proj=utm +zone=48 +ellps=WGS84\r\n// +datum=WGS84 +units=m +no_defs\");\r\n\r\nvar CRS = L.CRS.EPSG4326;\r\n\r\n\r\n/**\r\n * Hàm dùng để add 1 WMS layer mới, lu\r\n *\r\n * @map biến lưu giữ bản đồ\r\n * @param layername\r\n *            Tên lớp, bao gồm workspace:layername\r\n */\r\nfunction getCurrentBoundStr() {\r\n    var boundStr = '';\r\n    var mapBound = map.getBounds();\r\n    var leftbottom = mapBound._southWest;\r\n    var righttop = mapBound._northEast;\r\n    boundStr += righttop.lng + ' ' + righttop.lat + ',';\r\n    boundStr += leftbottom.lng + ' ' + righttop.lat + ',';\r\n    boundStr += leftbottom.lng + ' ' + leftbottom.lat + ',';\r\n    boundStr += righttop.lng + ' ' + leftbottom.lat + ',';\r\n    boundStr += righttop.lng + ' ' + righttop.lat;\r\n    return boundStr;\r\n}\r\n\r\n\r\nfunction create_New_WMS_Layer(map, layername, attribution, featurename) {\r\n    var layer = new L.TileLayer.BetterWMS(GEOSERVER_ADDRESS, {\r\n        layers: layername,\r\n        featureName: featurename,\r\n        format: FORMAT,\r\n        transparent: TRANSPARENT,\r\n        attribution: attribution,\r\n        tiled: true,\r\n        version: VERSION,\r\n        maxZoom: 25\r\n    });\r\n\r\n    return layer;\r\n}\r\n\r\nfunction create_WMS_Layer(map, layername, attribution, featurename) {\r\n    var layer = new L.TileLayer.WMS(GEOSERVER_ADDRESS, {\r\n        layers: layername,\r\n        format: FORMAT,\r\n        featureName: featurename,\r\n        transparent: TRANSPARENT,\r\n        attribution: attribution,\r\n        tiled: true,\r\n        version: VERSION,\r\n        maxZoom: 25,\r\n    });\r\n\r\n    return layer;\r\n}\r\n\r\nfunction panTo(lat, lng, zoom) {\r\n    zoom = typeof(zoom) == 'undefined' ? 17 : zoom;\r\n    map.panTo(L.latLng(lat, lng), {\r\n        animation: true\r\n    });\r\n    //'map.setView(L.latLng(lat, lng), zoom);\r\n    map.setZoom(zoom);\r\n    map.fireEvent('click', {latlng: [lat, lng]});\r\n}\r\n\r\nfunction panToNotFire(lat, lng, zoom) {\r\n    zoom = typeof(zoom) == 'undefined' ? 17 : zoom;\r\n    map.panTo(L.latLng(lat, lng), {\r\n        animation: true\r\n    });\r\n    map.setZoom(zoom);\r\n}\r\n\r\nfunction panToLatlng(latlng) {\r\n    map.panTo(latlng, {\r\n        animation: true\r\n    });\r\n    //map.setView(latlng, 17);\r\n    map.setZoom(17);\r\n    map.fireEvent('click', {latlng: [latlng.lat, latlng.lng]});\r\n}\r\n\r\n/**\r\n * @description split POINT(x y) to get x y\r\n * @param {type} input\r\n * @returns {undefined}\r\n */\r\nvar marker_group_onpan = null;\r\nfunction panToByGeometry(input, remove_group) {\r\n//    try {\r\n    // split ( to get \"x y)\"\r\n    var splitedString = input.split(\"(\");\r\n    // split ) to get x y\r\n    splitedString = splitedString[1].split(\")\");\r\n    // split to get x y\r\n    splitedString = splitedString[0].split(\" \");\r\n\r\n    var lat = splitedString[1];\r\n    var lng = splitedString[0];\r\n    var latlng = convertUTMToLatLng(lat, lng);\r\n\r\n    panToLatlng(latlng);\r\n\r\n    if (marker_group_onpan === null) {\r\n        marker_group_onpan = L.featureGroup().addTo(map);\r\n    }\r\n    remove_group = typeof (remove_group) === 'undefined' ? false : remove_group;\r\n    if (remove_group) {\r\n        marker_group_onpan.clearLayers();\r\n    }\r\n    marker_group_onpan.addLayer(L.marker(L.latLng(latlng)));\r\n}\r\n\r\nfunction getLatLng(input) {\r\n    try {\r\n        // split ( to get \"x y)\"\r\n        var splitedString = input.split(\"(\");\r\n        // split ) to get x y\r\n        splitedString = splitedString[1].split(\")\");\r\n        // split to get x y\r\n        splitedString = splitedString[0].split(\" \");\r\n        var lat = splitedString[1];\r\n        var lng = splitedString[0];\r\n\r\n        return [lat, lng];\r\n    } catch (ex) {\r\n        return [];\r\n    }\r\n}\r\n\r\nfunction getStringFromLatLngs(latlngs) {\r\n    var resStr = '';\r\n    for (var i = 0; i < latlngs.length; i++) {\r\n        resStr += ' ' + latlngs[i].lng + ' ' + latlngs[i].lat;\r\n        //if (i < latlngs.length - 1) {\r\n        resStr += ',';\r\n        //}\r\n    }\r\n\r\n    resStr += latlngs[0].lng + ' ' + latlngs[0].lat;\r\n\r\n    return resStr;\r\n}\r\n\r\n\r\n\r\nfunction initContextMenu() {\r\n    return {\r\n        contextmenu: true,\r\n        contextmenuWidth: 200,\r\n        contextmenuItems: [{\r\n            text: 'Thêm mới điểm thông tin',\r\n            callback: createNewCabenh,\r\n            icon: BASE_URL + 'resources/app/images/create_new.png'\r\n        }]\r\n    };\r\n}\r\n\r\nfunction createNewCabenh(e) {\r\n    var latlng = e.latlng;\r\n    var _target =  $('#id_btn_create_rp');\r\n    _target.attr('data-rp-x', latlng.lat);\r\n    _target.attr('data-rp-y', latlng.lng);\r\n    _target.click();\r\n}\r\n\r\nfunction initMapControl() {\r\n    L.control.measure({position: 'topright'}).addTo(map);\r\n    map.addControl(L.control.zoom({position: 'topright'}));\r\n\r\n}\r\n\r\nvar layerOpenStreetMap, layerDichte, layerRtPoint, layerCabenh, layerVungdich,layerQtiles, layerRanhto, layerVungbenh;\r\nvar maplayers = [];\r\n\r\nvar currentlayer = 'v_cabenh', layerMapThongke, layerRanhquan;\r\n\r\n\r\n\r\n\r\nvar preLayer = null;\r\nvar drawControl = null;\r\n\r\n\r\n\r\nfunction callDatas(postData, geomData) {\r\n    $.ajax({\r\n        type: 'POST',\r\n        url: BASE_URL + 'geo/dichte-in-polygon',\r\n        data: {'data': postData, 'sql': MAP_USER_FILTER, geomData: geomData},\r\n        success: function (html) {\r\n            callPopup(html);\r\n        }\r\n    });\r\n}\r\nvar check_khuvucdieutra = false;\r\nfunction callData(latlngs, data) {\r\n    if (!check_khuvucdieutra) {\r\n        $.ajax({\r\n            url: BASE_URL + 'geo/dichte-in-polygon',\r\n            data: latlngs !== null ?  {'bound': getStringFromLatLngs(latlngs), 'sql': MAP_USER_FILTER} : {'data' : data, 'sql': MAP_USER_FILTER},\r\n            success: function (html) {\r\n                callPopup(html);\r\n            }\r\n        })\r\n    } else {\r\n        $.ajax({\r\n            url: BASE_URL + 'geo/rt-in-polygon',\r\n            data: latlngs !== null ?  {'bound': getStringFromLatLngs(latlngs), 'sql': MAP_USER_FILTER} : {'data' : data, 'sql': MAP_USER_FILTER},\r\n            success: function (html) {\r\n                callPopup(html);\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nfunction openPanel() {\r\n\r\n}\r\n\r\nfunction callPopup(content) {\r\n    if (features_time_counter > 0) {\r\n        return;\r\n    }\r\n    if (content != '') {\r\n        //features_time_counter = 1;\r\n        //L.popup().setLatLng(latlng).setContent(content).openOn(map);\r\n        //uiUpdate('.leaflet-popup-content-wrapper');\r\n        document.getElementById(\"info\").innerHTML = content;\r\n        uiUpdate('.leaflet-popup-content-wrapper');\r\n        $(\"#feature_infos\").stop();\r\n        $(\"#feature_infos\").fadeIn(\"fast\");\r\n        uiUpdate('#feature_infos');\r\n    }\r\n}\r\n////////\r\n/**\r\n * Thank Ryan Clark for the codes of getFeatureInfo using leaflet.js\r\n * https://gist.github.com/rclark\r\n */\r\nvar feature_info_popup = null;\r\nvar addedLayers = L.layerGroup();\r\nL.TileLayer.BetterWMS = L.TileLayer.WMS.extend({\r\n    onAdd: function (map) {\r\n\r\n        // Triggered when the layer is added to a map.\r\n        // Register a click listener, then do all the upstream WMS things\r\n        L.TileLayer.WMS.prototype.onAdd.call(this, map);\r\n        addedLayers.addLayer(this);\r\n        map.on('click', this.getFeatureInfo, this);\r\n    },\r\n    onRemove: function (map) {\r\n        // Triggered when the layer is removed from a map.\r\n        // Unregister a click listener, then do all the upstream WMS things\r\n        L.TileLayer.WMS.prototype.onRemove.call(this, map);\r\n        addedLayers.removeLayer(this);\r\n        map.off('click', this.getFeatureInfo, this);\r\n    },\r\n    getFeatureInfo: function (evt) {\r\n        // Log\r\n        // Make an AJAX request to the server and hope for the best\r\n        var url = this.getFeatureInfoUrl(evt.latlng),\r\n            showResults = L.Util.bind(this.showGetFeatureInfo, this);\r\n\r\n        console.log(url);\r\n\r\n\r\n\r\n\r\n\r\n        $.ajax({\r\n            url: url,\r\n            success: function (data, status, xhr) {\r\n                var err = typeof data === 'string' ? null : data;\r\n                showResults(err, evt.latlng, data);\r\n            },\r\n            error: function (xhr, status, error) {\r\n                showResults(error);\r\n            }\r\n        });\r\n\r\n    },\r\n    getFeatureInfoUrl: function (latlng) {\r\n        /**\r\n         * Đoạn code sửa cho phù hợp với geoserver 2.4.4 (còn 1 đoạn nữa bên wmsgetfeatureinfo_control_data_processing.js);\r\n         */\r\n        var point = this._map.latLngToContainerPoint(latlng, this._map\r\n            .getZoom());\r\n        var size = this._map.getSize();\r\n        var params = {\r\n            CQL_FILTER: typeof(this.wmsParams.CQL_FILTER) != 'undefined' ? this.wmsParams.CQL_FILTER : '1=1',\r\n            request: 'GetFeatureInfo',\r\n            service: 'WMS',\r\n            srs: L.CRS.EPSG4326.code,\r\n            styles: this.wmsParams.styles,\r\n            transparent: this.wmsParams.transparent,\r\n            version: this.wmsParams.version,\r\n            format: this.wmsParams.format,\r\n            bbox: this._map.getBounds().toBBoxString(),\r\n            height: size.y,\r\n            width: size.x,\r\n            layers: this.wmsParams.layers,\r\n            query_layers: this.wmsParams.layers,\r\n            info_format: 'text/html',\r\n            feature_count: 100\r\n        };\r\n        params[params.version === '1.3.0' ? 'i' : 'x'] = point.x;\r\n        params[params.version === '1.3.0' ? 'j' : 'y'] = point.y;\r\n\r\n        return this._url + L.Util.getParamString(params, this._url, true);\r\n    },\r\n    showGetFeatureInfo: function (err, latlng, content) {\r\n        // Add content to empty div\r\n        var _div_tmp = $('#div_tmp');\r\n        _div_tmp.empty().append(content);\r\n\r\n        // Get feature name and pass to call matching function\r\n        var _feature_name = $('#div_tmp caption.featureInfo').text();\r\n        //if  (_feature_name == currentlayer)\r\n        content = getFeatureInforContentFactory(content);\r\n\r\n        console.log(content);\r\n\r\n        callPopup(content);\r\n//        // convert response geoserver content to popup content\r\n//        feature_info_popup = L.popup({maxWidth: 800})\r\n//                .setLatLng(latlng);\r\n//        content = wmsgetfeatureinfo_control_data_process(feature_info_popup, content);\r\n//        if (content === '') {\r\n//            return;\r\n//        }\r\n//        if (err) {\r\n//            console.log(err);\r\n//            return;\r\n//        } // do nothing if there's an error\r\n//        // Otherwise show the content in a popup, or something.\r\n//\r\n//        // Log\r\n//        feature_info_popup\r\n//                .setContent(content)\r\n//                .openOn(this._map);\r\n    }\r\n});\r\n\r\nfunction getFeatureInforContentFactory(content) {\r\n    var result = window['getFeatureInforv_cabenh']();\r\n    result += window['getFeatureInforv_vungbenh']();\r\n    return result;\r\n}\r\nfunction getFeatureInforFromListProp(props, id, name) {\r\n    if ($(props[0].selector).length > 1)\r\n        return getFeatureInforFromListPropOver2(props, id, name);\r\n    else\r\n        return getFeatureInforFromListPropOne(props, id, name);\r\n}\r\n\r\nfunction getFeatureInforFromListPropOne(props, id, name) {\r\n    var result = '<div id=\"map_popup\" style=\"width: 100%; overflow: auto\"><table class=\"table table-condensed table-triped table-hover\">';\r\n    var empty = true;\r\n    for (var i = 0; i < props.length; i++) {\r\n        if ($(props[i].selector).text() !== '') {\r\n            empty = false;\r\n        }\r\n        result += '<tr>';\r\n        result += '<td><b>' + props[i].name + '</b></td><td>&nbsp;</td><td>';\r\n        //result += props[i].formatter === 'number' ? Number($(props[i].selector).text()).format(2, 3, '.', ',') : $(props[i].selector).text();\r\n        result += formatter(props[i].formatter, $($(props[i].selector)[0]).text());\r\n        result += '</td>';\r\n        result += '</tr>';\r\n    }\r\n\r\n    var idvalue = $($(id)).text();\r\n    var namevalue = $($(name)).text();\r\n\r\n    if (currentlayer == 'v_cabenh') {\r\n        result += '<tr><td>';\r\n        result += '<a class=\"custom-reload-ajax-div custom-expand-sidebar\" data-url=\"' + BASE_URL + 'dichte/cabenh1/index?partial=true&onmap=true&sort=loai_dich&Cabenh1Search[macabenh]=' + idvalue + '\" data-target=\"#id_div_cabenh\">Cập nhật thông tin</a>';\r\n        result += '</tr></td';\r\n    }\r\n\r\n    result += '</table></div>';\r\n\r\n    return empty ?  '' : result;\r\n}\r\n\r\nfunction getFeatureInforFromListPropOver2(props, id, name) {\r\n    var result = '<div id=\"map_popup\" style=\"width: 100%; overflow: auto\"><table class=\"table table-condensed table-triped table-hover\">';\r\n    var trs = '';\r\n    var ths = '';\r\n    var columns = props.length;\r\n    if (columns > 0) {\r\n        ths += '<tr>';\r\n        for (var i = 0; i < columns; i++) {\r\n            ths += '<td><b>' + props[i].name + '</b></td>';\r\n        }\r\n        ths += '</tr>';\r\n        var rows = $(props[0].selector).length;\r\n        for (var i = 0; i < rows; i++) {\r\n            trs += '<tr>';\r\n            for (var j = 0; j < columns; j++) {\r\n                var text = $($(props[j].selector)[i]).text();\r\n                trs += '<td>' + formatter(props[j].formatter, text) + '</td>';\r\n            }\r\n            var idvalue = $($(id)[i]).text();\r\n            var namevalue = $($(name)[i]).text();\r\n            trs += '</tr>';\r\n        }\r\n    }\r\n\r\n    result += ths + trs + '</table></div>';\r\n\r\n    return trs == '' ? '' : result;\r\n}\r\n\r\nfunction formatter(type, value) {\r\n    if (typeof(type) == 'undefined') {\r\n        return value;\r\n    }\r\n    if (type === 'number') {\r\n        return Number(value).format(2, 3, '.', ',');\r\n    } else if (type === 'integer') {\r\n        return Number(value).format(0, 3, '.', ',');\r\n    } else if (type.indexOf('date') > -1) {\r\n        var arrFormat = type.split('::');\r\n        var format = arrFormat[1];\r\n        return Date.parseExact(value, format);\r\n    }\r\n}\r\n\r\nfunction getFeatureInforv_cabenh() {\r\n    var result = getFeatureInforFromListProp([\r\n        {name: 'Họ tên', selector: '.v_cabenh_hoten'},\r\n        {name: 'Ngày mắc bệnh', selector: '.v_cabenh_ngaymacbenh'},\r\n        {name: 'Ngày nhập viện', selector: '.v_cabenh_ngaynhapvien'},\r\n        {name: 'Chuẩn đoán', selector: '.v_cabenh_chuandoan_xv'},\r\n    ], '.v_cabenh_macabenh', '.v_cabenh_hoten');\r\n    return result;\r\n}\r\n\r\nfunction getFeatureInforv_vungbenh() {\r\n    var result = getFeatureInforFromListProp([\r\n        {name: 'Họ tên', selector: '.v_vungbenhhoten'},\r\n        {name: 'Mã ICD', selector: '.v_vungbenh_ma_icd'},\r\n        {name: 'Tổ ảnh hưởng 200m',  selector: '.v_vungbenh_totiepgiap'},\r\n        {name: 'Tổng diện tích tổ',  selector: '.v_vungbenh_dientichto', formatter: 'number'},\r\n        {name: 'Ngày mắc bệnh', selector: '.v_vungbenh_ngaymacbenh'},\r\n        {name: 'Ngày nhập viện', selector: '.v_vungbenh_ngangnhapvien'},\r\n        {name: 'Chuẩn đoán', selector: '.v_vungbenh_chuandoan'},\r\n        {name: 'Tên phường', selector: '.v_vungbenh_ten_phuong'},\r\n        {name: 'Tên quận', selector: '.v_vungbenhh_ten_quan'},\r\n        {name: 'Loại dịch', selector: '.v_vungbenh_loai_dich'}\r\n    ], '.v_vungbenh_macabenh', '.v_vungbenh_hoten');\r\n    return result;\r\n}\r\n\r\nfunction getFeatureInforrt_point() {\r\n    var result = getFeatureInforFromListProp([\r\n        {name: 'Họ tên', selector: '.v_cabenh_hoten'},\r\n        {name: 'Mã ICD', selector: '.v_cabenh_ma_icd'},\r\n        {name: 'Ngày mắc bệnh', selector: '.v_cabenh_ngaymacbenh'},\r\n        {name: 'Ngày nhập viện', selector: '.v_cabenh_ngangnhapvien'},\r\n        {name: 'Chuẩn đoán', selector: '.v_cabenh_chuandoan'},\r\n        {name: 'Tên phường', selector: '.v_cabenh_ten_phuong'},\r\n        {name: 'Tên quận', selector: '.v_cabenh_ten_quan'},\r\n    ], '.v_cabenh_macabenh', '.v_cabenh_hoten');\r\n    return result;\r\n}\r\n\r\n\r\nfunction createMatcatLink(url, ten_vn) {\r\n    var result = '';\r\n    if (ten_vn !== '') {\r\n        result += \"<a class='pointer-cursor custom-button-ajax-call custom-button-trigger-other custom-change-label' \"\r\n            + \"data-change-target='#span_tenkenh' data-change-content='\" + ten_vn + \"' \"\r\n            + \"data-trigger-target='#btn_toggle_matcat' \"\r\n            + \"data-url='\" + url + \"' data-target-div='#div_matcat'>Xem mặt cắt</a>\";\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction getFeatureInfordichte() {\r\n    return [];\r\n}\r\n\r\nfunction getFeatureInforrt_point() {\r\n    return [];\r\n}\r\n\r\n\r\nfunction convertUTMToLatLng(lat, lng) {\r\n    var UTM48 = \"+proj=utm +zone=48 +ellps=WGS84 +datum=WGS84 +units=m +no_defs\";\r\n    var LATLNG = \"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs \";\r\n    var result = proj4(LATLNG, LATLNG, [lng, lat]);\r\n    var latlng = L.latLng(result[1], result[0]);\r\n    console.log(latlng);\r\n    return latlng;\r\n}\r\n\r\n\r\n\r\n///// APP JS\r\nvar layerRanhphuong;\r\nfunction getInitRanhphuong() {\r\n    maplayers['layerRanhphuong'] = layerRanhphuong = create_New_WMS_Layer(map, 'dichte:dm_phuong', '', 'dm_phuong');\r\n    checkRanhphuong();\r\n\r\n    return layerRanhphuong;\r\n}\r\n\r\nvar filterPhuongquan = '';\r\nfunction checkRanhphuong() {\r\n\r\n    $.ajax({\r\n        url : BASE_URL + 'geo/ranhphuong',\r\n        success: function (data) {\r\n            data = JSON.parse(data);\r\n\r\n            if (data.filter != '') {\r\n                MAP_USER_FILTER.ranh_phuong = '(' + data.filter + ')';\r\n                data.filter = filterMapBySelect();\r\n                layerRanhphuong.setParams({CQL_FILTER: data.filter});\r\n                layerCabenh.setParams({CQL_FILTER: filterMapBySelect()});\r\n\r\n            }\r\n\r\n            if (data.geo.lat != '') {\r\n                panTo(data.geo.lat, data.geo.lng, 17);\r\n                // map.setMaxBounds(map.getBounds());\r\n\r\n                map.addLayer(layerRanhphuong);\r\n                map.addLayer(layerCabenh);\r\n            }\r\n\r\n        }\r\n    })\r\n}\r\n\r\nfunction filterMapBySelect() {\r\n    var filter = '1 = 1';\r\n    for(var key in MAP_USER_FILTER) {\r\n        filter += ' and ' + MAP_USER_FILTER[key];\r\n    }\r\n    return filter;\r\n}\r\n\r\n"]}