{"version":3,"sources":["webpack:///./modules/react-map/app/components/MapLayout.js?cdf7"],"names":["BaseLayer","Overlay","formatDate","date","fromD","toD","moment","format","props","context","showGetFeatureInfo","err","latlng","content","features","length","model","properties","updateSxhModel","from","showPopup","pin","setState","popCabenh","settings","srvData","hanhchinh","layerUrl","state","envCabenh","getEnvCabenh","cqlPhuong","getCqlPhuong","legendCabenh","getLegend","map","window","refs","getWrappedInstance","leafletElement","setTimeout","initRefs","deleteKvSxh","kvGroup","on","layers","e","IDs","eachLayer","push","layer","featureID","nextProps","googleAddr","flyTo","sxh_model","sxh_showPopup","sxh_filter","odsxh_flyto","zoomGoogleAddr","flyToLoc","flyToBounds","prevProps","prevState","cabenhWMS","cabenhLayer","kvWMS","kvLayer","setParams","cql_filter","getCqlCabenh","location","label","marker","L","icon","wave","heartbeat","bindPopup","closeButton","addTo","removeLayer","getZoom","color","map_sxh","legend","cb_color_7","cb_color_814","cb_color_1521","cb_color_2228","cb_color_28","cb_color_sxv","cb_color_khac","field","ma_phuong","ma_quan","giapranh","res","resOr","datefrom","dateto","benhnhan","loaibenh","timeShowCB","cb_during","last3Month","add","params","split","val","trim","join","env","replace","v","sxh_khoanhvung","odsxh_sxh","odsxh_model","gisnen","ranhphuong","ranhquan","ranhto","cabenh","kvsxh","test_kvsxh","geo_odsxh","getViewParams","polyline","rectangle","polygon","id","center","radius","macabenh","lat","lng","dientichdk","contextTypes","object","mapStateToProps","sxh","filter","khoanhvung","sxhOdich","sxhs","flytoBounds","MapLayout"],"mappings":"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","file":"0.80191c54f09549d1a7e1.hot-update.js","sourcesContent":["import React, {Component, PropTypes} from 'react';\r\nimport {render} from 'react-dom'\r\nimport {connect} from 'react-redux';\r\nimport { context, resolve } from 'react-resolver';\r\nimport {head, isEmpty, compact, pick, includes} from 'lodash';\r\nimport {Circle, ChoroplethLayer, Marker, Popup, LegendControl, DrawControl, FeatureGroup, LocateControl, MeasureControl, Map, ZoomControl, LayersControl, TileLayer, WMSTileLayer, FullscreenControl} from '../map';\r\nconst {BaseLayer, Overlay} = LayersControl;\r\n\r\nimport PopCabenh from './dichte/PopCabenh';\r\nimport {updateSxhModel} from '../actions/sxhActions';\r\nimport {arrToCQL, cqlJoin, formatNumber, last3Month, paramJoin} from '../utils';\r\nimport {deleteKvSxh} from '../actions/sxhActions';\r\n\r\nvar formatDate = (date, fromD = 'DD-MM-YYYY', toD = 'YYYY/MM/DD') => {\r\n    return moment(date, fromD).format(toD);\r\n}\r\n\r\nclass MapLayout extends Component {\r\n    static contextTypes = {\r\n        srvData: PropTypes.object,\r\n    };\r\n\r\n    constructor(props, context){\r\n        super(props, context);\r\n\r\n        this.settings = context.srvData.settings;\r\n        this.hanhchinh = context.srvData.hanhchinh;\r\n        this.layerUrl = context.srvData.layerUrl;\r\n\r\n        this.state = {\r\n            popCabenh: null,\r\n        }\r\n\r\n\r\n    }\r\n\r\n    componentWillMount(){\r\n        this.envCabenh = this.getEnvCabenh();\r\n        this.cqlPhuong = this.getCqlPhuong();\r\n        this.legendCabenh = this.getLegend();\r\n    }\r\n\r\n    componentDidMount(){\r\n        this.map = window.map = this.refs.map.getWrappedInstance().leafletElement;\r\n        setTimeout(::this.initRefs);\r\n    }\r\n\r\n    initRefs() {\r\n        const {deleteKvSxh} = this.props;\r\n        const {kvGroup} = this.refs;\r\n        this.kvGroup = kvGroup.leafletElement;\r\n\r\n        this.map.on('draw:deleted', e =>  {\r\n            let layers = e.layers,\r\n                IDs = [];\r\n            layers.eachLayer(layer => IDs.push(layer.featureID));\r\n            deleteKvSxh(IDs);\r\n        });\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps){\r\n        const {googleAddr, flyTo, sxh_model, sxh_showPopup, sxh_filter, odsxh_flyto} = nextProps;\r\n\r\n        if(googleAddr && googleAddr !== this.props.googleAddr){ this.zoomGoogleAddr(googleAddr); }\r\n\r\n        if(flyTo && flyTo !== this.props.flyTo){ this.flyToLoc(flyTo); }\r\n        if(odsxh_flyto && odsxh_flyto !== this.props.odsxh_flyto){ this.map.flyToBounds(odsxh_flyto); }\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState){\r\n        const {sxh_filter} = this.props;\r\n        if(sxh_filter && sxh_filter !== prevProps.sxh_filter){\r\n            const {leafletElement: cabenhWMS} = this.refs.cabenhLayer;\r\n            const {leafletElement: kvWMS} = this.refs.kvLayer;\r\n            cabenhWMS.setParams({cql_filter: this.getCqlCabenh()});\r\n            kvWMS.setParams({cql_filter: this.getCqlCabenh()});\r\n        }\r\n    }\r\n\r\n    zoomGoogleAddr(googleAddr){\r\n        const {location, label} = googleAddr;\r\n        this.flyToLoc(location);\r\n        let marker = L.marker(location, {icon: L.icon.wave({heartbeat: 2})})\r\n            .bindPopup(`<b>${label}`, {closeButton: false}).addTo(this.map);\r\n        setTimeout(() => {this.map.removeLayer(marker)}, 15000)\r\n    }\r\n\r\n    flyToLoc(location){\r\n        // Kiểm tra nếu tọa độ k nằm TPHCM cảnh báo, k zoom;\r\n\r\n        this.map.getZoom() < 12 ? this.map.flyTo(location, 15) : this.map.flyTo(location);\r\n    }\r\n\r\n    getLegend(){\r\n        let color = this.settings.map_sxh;\r\n\r\n        let legend = `\r\n            <div class=\"legend-title\">Chú giải</div>\r\n            <div class=\"legend-scale\">\r\n                <ul class='legend-labels'>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_7};'></span> <= 7 </li>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_814};'></span> 8 - 14</li>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_1521};'></span> 15 - 21</li>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_2228};'></span> 22 - 28</li>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_28};'></span> >= 28</li>\r\n                    <hr>\r\n                    <li> <span class=\"legCircle\" style='background:#aa2672;'></span> Zika</li>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_sxv};'></span> Sốt</li>\r\n                    <li> <span class=\"legCircle\" style='background:${color.cb_color_khac};'></span> Khác</li>\r\n                </ul>\r\n            </div>\r\n        `;\r\n        return legend;\r\n    }\r\n\r\n    getCqlPhuong(field = 'ma_phuong') {\r\n        const {ma_phuong, ma_quan, giapranh} =  this.hanhchinh;\r\n        let res = [];\r\n        if (ma_phuong && giapranh) res.push([`(${giapranh})`]);\r\n\r\n        return arrToCQL(res);\r\n    }\r\n\r\n\r\n    getCqlCabenh() {\r\n        let res = [], resOr = [];\r\n        let {datefrom, dateto, benhnhan, loaibenh} = this.props.sxh_filter;\r\n\r\n        const {ma_phuong, ma_quan, giapranh} =  this.hanhchinh;\r\n        // Xét thời gian hiển thị ca bệnh\r\n        let timeShowCB = this.settings.map_sxh.cb_during;\r\n        let last3Month = moment().add(-1 * timeShowCB, 'months').format('DD/MM/YYYY');\r\n\r\n        if (ma_phuong) {\r\n            res.push(['ma_phuong', 'IN', `(${giapranh})`])\r\n        }\r\n        if (ma_quan) {\r\n            res.push(['ma_quan', 'IN', `(${giapranh})`])\r\n        }\r\n\r\n\r\n        if (datefrom) {\r\n            dateto = dateto ? dateto : moment().format('DD/MM/YYYY');\r\n\r\n            res.push(['ngaymacbenh_nv', '>=', `'${formatDate(datefrom)}'`]);\r\n            res.push(['ngaymacbenh_nv', '<=', `'${formatDate(dateto)}'`]);\r\n        } else {\r\n            res.push(['ngaymacbenh_nv', '>=', `'${formatDate(last3Month)}'`])\r\n        }\r\n\r\n        if (loaibenh && includes(loaibenh, 'sxh')) resOr.push(['cdc_cbn_sxh', '>', 0]);\r\n        if (loaibenh && includes(loaibenh, 'sot')) resOr.push(['cdc_cbn_sot', '>', 0]);\r\n        if (loaibenh && includes(loaibenh, 'khac')) resOr.push(['cdc_cbn_benhkhac', '>', 0]);\r\n        // if(has(benhnhan, 'on')) res.push(['cdc_cbn_benhkhac', '>', 0]);\r\n        // if(has(benhnhan, 'off')) res.push(['cdc_cbn_benhkhac', '>', 0]);\r\n\r\n        return cqlJoin([arrToCQL(res), arrToCQL(resOr, 'or')], ' and ', '1=1');\r\n    }\r\n\r\n    getViewParams() {\r\n        const {ma_phuong, ma_quan, giapranh} =  this.hanhchinh;\r\n        let params = [\r\n            ['ngaymacbenh', `${last3Month(6)}`],\r\n        ]\r\n\r\n        if (ma_phuong) {\r\n            params.push(['ma_phuong', `and ma_phuong in (${giapranh.split(',').map(val => val.trim()).join('\\\\,')})`])\r\n        }\r\n\r\n        if (ma_quan) {\r\n            params.push(['ma_quan', `and ma_quan in (${giapranh.split(',').map(val => val.trim()).join('\\\\,')})`])\r\n        }\r\n\r\n        return paramJoin(params);\r\n    }\r\n\r\n    showGetFeatureInfo = (err, latlng, content) => {\r\n        if (!content.features.length) { return; };\r\n        let model = head(content.features).properties;\r\n\r\n\r\n        this.props.updateSxhModel({...model, from: 'map'});\r\n    }\r\n\r\n    getEnvCabenh() {\r\n        let color = this.settings.map_sxh;\r\n        let env = [\r\n            ['cnull', '8C8C8C'],\r\n            ['c7', color.cb_color_7.replace('#', '')],\r\n            ['c7-14', color.cb_color_814.replace('#', '')],\r\n            ['c14-21', color.cb_color_1521.replace('#', '')],\r\n            ['c21-28', color.cb_color_2228.replace('#', '')],\r\n            ['c28', color.cb_color_28.replace('#', '')],\r\n            ['csxv', color.cb_color_sxv.replace('#', '')],\r\n            ['ckhac', color.cb_color_khac.replace('#', '')],\r\n        ];\r\n        return env.map(v => v.join(':')).join(';')\r\n    }\r\n\r\n    showPopup = (model, pin = false) => {\r\n        this.setState({\r\n            popCabenh: (\r\n                <PopCabenh pin={pin} data={model}/>\r\n            )\r\n        })\r\n    }\r\n\r\n\r\n    render(){\r\n        const {sxh_showPopup, sxh_model, sxh_khoanhvung, odsxh_sxh, odsxh_model} = this.props;\r\n\r\n        const {gisnen, ranhphuong, ranhquan, ranhto, cabenh, kvsxh, test_kvsxh, geo_odsxh} = this.layerUrl;\r\n\r\n\r\n        return (\r\n            <Map\r\n                zoomControl={false}\r\n                ref=\"map\"\r\n            >\r\n                <ZoomControl/>\r\n                <LocateControl />\r\n                <LayersControl position='topright' filterLayers>\r\n                    <BaseLayer name='GIS nền' checked>\r\n                        <WMSTileLayer url={gisnen} layers='hcm_map:hcm_map'/>\r\n                    </BaseLayer>\r\n                    <BaseLayer name='Google'>\r\n                        <TileLayer url='http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}'\r\n                                   subdomains={['mt0', 'mt1', 'mt2', 'mt3']}/>\r\n                    </BaseLayer>\r\n                    <BaseLayer name='Mapbox'>\r\n                        <TileLayer\r\n                            url='https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}'\r\n                            id=\"mapbox.streets\"\r\n                            accessToken=\"pk.eyJ1IjoidHR1bmdibXQiLCJhIjoiY2EzNDFhZjU4ZThkNzY5NTU3M2U1YWFiNmY4OTE3OWQifQ.Bo1ss5J4UjPPOjmq9S3VQw\"\r\n                            attribution='Map data &copy; <a href=\"http://mapbox.com\">Mapbox</a>'/>\r\n                    </BaseLayer>\r\n                    <BaseLayer name='OSM'>\r\n                        <TileLayer url='http://{s}.tile.osm.org/{z}/{x}/{y}.png'\r\n                                   attribution='&copy <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'/>\r\n                    </BaseLayer>\r\n                    <BaseLayer name='Ảnh vệ tinh'>\r\n                        <TileLayer url='http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}'\r\n                                   subdomains={['mt0', 'mt1', 'mt2', 'mt3']}/>\r\n                    </BaseLayer>\r\n                    <BaseLayer name='Ảnh hàng không'>\r\n                        <TileLayer url='http://hcmgisportal.vn/basemap/cache_lidar/{z}/{x}/{y}.jpg'/>\r\n                    </BaseLayer>\r\n                    <Overlay name='Ranh tổ'>\r\n                        <WMSTileLayer url={ranhto} layers='dichte:ranh_to' transparent='true'/>\r\n                    </Overlay>\r\n                    <Overlay name='Ranh phường'>\r\n                        <WMSTileLayer\r\n                            url={ranhphuong}\r\n                            layers='dichte:dm_phuong_new'\r\n                            featureid={this.cqlPhuong}\r\n                            tiled={false}\r\n                            transparent='true'/>\r\n                    </Overlay>\r\n                    <Overlay name='Ranh quận'>\r\n                        <WMSTileLayer\r\n                            url={ranhquan}\r\n                            layers='dichte:dm_quan'\r\n                            transparent='true'/>\r\n                    </Overlay>\r\n\r\n                    <Overlay name='Ca bệnh' checked>\r\n                        <WMSTileLayer\r\n                            layerID=\"cabenh\"\r\n                            ref=\"cabenhLayer\"\r\n                            url={cabenh}\r\n                            layers='dichte:v_cbsxh'\r\n                            transparent='true'\r\n                            cql_filter={this.getCqlCabenh()}\r\n                            env={this.envCabenh}\r\n                            showGetFeatureInfo={this.showGetFeatureInfo}\r\n                            time=\"2013-03-10T00:00:00.000Z\"\r\n                        />\r\n                    </Overlay>\r\n                    <Overlay name='Khoanh vùng'>\r\n                        <WMSTileLayer\r\n                            ref=\"kvLayer\"\r\n                            url={kvsxh}\r\n                            layers='dichte:v_kvsxh'\r\n                            transparent='true'\r\n                            cql_filter={this.getCqlCabenh()}\r\n                        />\r\n                    </Overlay>\r\n                    <Overlay name='Khoanh vùng (Điều kiện)'>\r\n                        <WMSTileLayer\r\n                            url={test_kvsxh}\r\n                            layers='dichte:test_kvsxh'\r\n                            transparent='true'\r\n                            viewparams={this.getViewParams()}\r\n                        />\r\n                    </Overlay>\r\n                    <Overlay name='Ổ dịch SXH'>\r\n                        <WMSTileLayer\r\n                            url={geo_odsxh}\r\n                            layers='dichte:geo_odsxh'\r\n                            transparent='true'\r\n                        />\r\n                    </Overlay>\r\n                </LayersControl>\r\n\r\n\r\n                <MeasureControl position=\"topleft\"/>\r\n                <FullscreenControl position=\"bottomright\"/>\r\n                <LegendControl html={this.legendCabenh} />\r\n\r\n                <FeatureGroup ref=\"kvGroup\">\r\n                    <DrawControl\r\n                        draw={{marker:false, polyline: false, rectangle: false, polygon: false}}\r\n                    />\r\n\r\n\r\n                    {sxh_khoanhvung.map(val => (\r\n                        <Circle id={val.id} key={val.id} center={val.center} radius={val.radius} color={val.color ? val.color : '#67c3e5'} ></Circle>\r\n                    ))}\r\n                </FeatureGroup>\r\n\r\n                    {odsxh_sxh.map(val => (\r\n                        <Circle id={val.macabenh} key={val.macabenh} center={[val.lat, val.lng]} radius={200} color=\"#f69a33\" >\r\n                            <Popup minWidth={200}>\r\n                                <div className=\"pop-wrapper\">\r\n                                    <div className=\"pop-title text-uppercase\">Ổ dịch #{odsxh_model.id}</div>\r\n                                    <div className=\"pop-body\">\r\n                                        <ul className=\"list-data mb-10\">\r\n                                            <li><b>Tổng số ca: </b> {odsxh_sxh.length}</li>\r\n                                            <li><b>Tổ ảnh hưởng: </b> </li>\r\n                                            <li><b>Diện tích: </b> {formatNumber(odsxh_model.dientichdk)} m²</li>\r\n                                            <li><b>Ca đầu tiên: </b> </li>\r\n                                            <li><b>Ca gần nhất: </b> </li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </div>\r\n                            </Popup>\r\n                        </Circle>\r\n                    ))}\r\n\r\n\r\n                {sxh_showPopup ? <PopCabenh pin={sxh_showPopup} data={sxh_model}/> : null}\r\n            </Map>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    const {googleAddr, flyTo} = state.map;\r\n    const {model, showPopup, filter, khoanhvung} = state.sxh;\r\n    const {sxhs, flytoBounds} = state.sxhOdich;\r\n\r\n    return {\r\n        googleAddr, flyTo,\r\n        sxh_model: model,\r\n        sxh_showPopup: showPopup,\r\n        sxh_filter: filter,\r\n        sxh_khoanhvung: khoanhvung,\r\n\r\n        odsxh_model: state.sxhOdich.model,\r\n        odsxh_sxh: sxhs,\r\n        odsxh_flyto: flytoBounds,\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps, {updateSxhModel, deleteKvSxh})(MapLayout);\n\n\n// WEBPACK FOOTER //\n// ./modules/react-map/app/components/MapLayout.js"],"sourceRoot":""}